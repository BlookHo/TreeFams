%li.new-profile-form
  %h2
    Добавить
    = YandexInflect.inflections( relation_to_human(@profile.relation_id) )[3]["__content__"]

  -#= render 'shared/ui/flash'
  - if flash[:alert]
    .flash.alert
      = flash[:alert]

  = form_for @profile, remote: true do |f|
    = hidden_field_tag :base_profile_id, params[:base_profile_id]
    = hidden_field_tag :base_relation_id, params[:base_relation_id]
    = hidden_field_tag :path_link, params[:path_link]
    = f.hidden_field   :relation_id

    - if @questions
      = hidden_field_tag "profile[name]", (@profile.to_name || params.try(:[], :profile).try(:[], :name)), class: [:autocomplete_field], placeholder: "Имя...", data:{names: Name.approved.map{|n| n.name.mb_chars.capitalize } }
      #questions-fields
        - if @profile.answers_hash.nil?
          - q = @questions.first
        - else
          - q = @questions.delete_if {|q| @profile.answers_hash.try(:keys).include? q.id.to_s}.first

        - # keep answers
        - @profile.answers_hash.try(:each) do |answer_id, answer_value|
          = hidden_field_tag "answers[#{answer_id}]", answer_value

        .question
          .text
            = q.text
          .answer
            %label.btn.green
              = radio_button_tag "answers[#{q.id}]", 1, @profile.answers_hash.try(:[], "#{q.id}") == 1.to_s, onclick: "$('#new_profile').submit()"
              Да
            %label.btn.red
              = radio_button_tag "answers[#{q.id}]", 0, @profile.answers_hash.try(:[], "#{q.id}") == 0.to_s, onclick: "$('#new_profile').submit()"
              Нет
    - else
      #main-new-profile-field
        - if flash[:name_warning]
          .flash.warning
            = flash[:name_warning]
        - if flash[:name_warning]
          = check_box_tag :new_name_confirmation
          Имя указано верно
          %br
          %br

      = text_field_tag "profile[name]", (@profile.to_name || params.try(:[], :profile).try(:[], :name)), class: [:autocomplete_field], placeholder: "Имя...", data:{names: Name.approved.map{|n| n.name.mb_chars.capitalize } }

    - unless @questions
      .actions
        = link_to 'Отмена', '#cancel', onclick: "closeAllDropDown();", class: :cancel
        = f.submit "Добавить", class: [:btn, :green], data: { disable_with: "Подождите..." }
